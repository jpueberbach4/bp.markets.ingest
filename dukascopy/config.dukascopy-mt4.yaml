# Dukascopy MT4 Data Pipeline Configuration
#
# This configuration file controls the behavior of the Dukascopy MT4 data processing suite,
# including downloading, transforming, aggregating, and resampling historical and live market data.
#
# Sections:
# 1. aggregate: Controls input/output paths for aggregation.
# 2. download: Retry/backoff settings, timeouts, rate limits, and paths for historical/live downloads.
# 3. transform: Time-shifting, rounding, input/output paths, and preparation for aggregation/resampling.
# 4. resample: Batch size, rounding precision, multi-timeframe resampling rules, and per-symbol overrides.
#
# Purpose:
# - Automate crash-resilient ETL pipelines for financial market data.
# - Support incremental updates with strict time-bin alignment across multiple timeframes.
# - Allow flexibility for various asset classes (forex, commodities, indices, crypto, bonds).
#
# Usage:
# - Imported by ETL scripts to configure paths, timeframes, rate limits, and resampling rules.
# - Customization per instrument or timeframe via the `symbols` section.
#
# Note:
# - Under development; features/settings may change.
# - Paths are relative to project root unless specified otherwise.

# Below you will find the configuration for the aggregate.py script. 
aggregate:
  paths:
    data: data/aggregate/1m           # Output path for aggregate
    source: data/transform/1m         # Input path for aggregate

## Below you will find the configuration for the builder script
builder:
  paths:
    data: data                        # Input path for builder
    temp: data/temp/builder           # Temporary path for builder

# Below you will find the configuration for the download.py script. 
download:
  max_retries: 3                      # Number of retries before downloader raises
  backoff_factor: 2                   # Exponential backoff factor (wait time)
  timeout: 10                         # Request timeout
  rate_limit_rps: 1                   # Protect end-point (number of cores * rps = requests/second)
  paths:
    historic: cache                   # Historical downloads
    live: data/temp                   # Live downloads

# Below you will find the configuration for the transform.py script. 
transform:
  time_shift_ms: 7200000              # How many milliseconds should we shift (0=UTC, 7200000=GMT+2 (eg MT4 Dukascopy) )
  round_decimals: 8                   # Number of decimals to round OHLCV to
  paths:
    data: data/transform/1m           # Output directory for transform
    historic: cache                   # Historical downloads
    live: data/temp                   # Live downloads
  timezones:
    America/New_York:                 # The MT4 Server switches between GMT+2/GMT+3 based on DST change of this timezone
      offset_to_shift_map:            # Defines a map to shift based on offset minutes
        -240: 10800000                # UTC-4 (US DST) -> GMT+3 shift
        -300: 7200000                 # UTC-5 (US Standard) -> GMT+2 shift
      symbols:                        # Basically you add any symbol you are using here.
      - XAU-USD                       # Investigation about Crypto is ongoing. 
      - XAG-USD
      - XPT.CMD-USD
      - XPD.CMD-USD
      - BRENT.CMD-USD
      - LIGHT.CMD-USD
      - DIESEL.CMD-USD
      - GAS.CMD-USD
      - COPPER.CMD-USD
      - OJUICE.CMD-USX
      - SOYBEAN.CMD-USX
      - COTTON.CMD-USX
      - USA30.IDX-USD
      - USA500.IDX-USD
      - USATECH.IDX-USD
      - USSC2000.IDX-USD
      - JPN.IDX-JPY
      - DOLLAR.IDX-USD
      - USTBOND.TR-USD
      - GBR.IDX-GBP
      - DEU.IDX-EUR
      - BUND.TR-EUR
      - EUR-USD                     # This is MT4 server wide. Not symbol specific.

# Below you will find the configuration for the resample.py script. 
resample:
  round_decimals: 8                   # Number of decimals to round OHLCV to
  batch_size: 250000                  # Maximum number of lines to read per batch
  paths:
    data: data/resample               # Output directory for resampled timeframes
  timeframes:
    1m:
      source: "data/aggregate/1m"     # No rule, no resample, source defines output path for this timeframe
    5m:
      rule: "5T"                      # 5-minute timeframe
      label: "left"                   # Label (timestamp) assigned to each resampled interval comes from the left (start) edge of the window
      closed: "left"                  # Window is left-inclusive, right-exclusive
      source: "1m"                    # Uses 1m timeframe as input (see previous entry)
    15m:
      rule: "15T"                     # 15-minute timeframe
      label: "left"
      closed: "left"
      source: "5m"                    # Uses 5m timeframe as input (see previous entry)
    30m:
      rule: "30T"                     # And so on....
      label: "left"
      closed: "left"
      source: "15m"
    1h:
      rule: "1H"
      label: "left"
      closed: "left"
      source: "30m"
    4h:
      rule: "4H"
      label: "left"
      closed: "left"
      source: "1h"
    8h:
      rule: "8H"
      label: "left"
      closed: "left"
      source: "4h"
    1d:
      rule: "1D"
      label: "left"
      closed: "left"
      source: "8h"
    1W:
      rule: "W-MON"
      label: "left"
      closed: "left"
      source: "1d"
    1M:
      rule: "MS"
      label: "left"
      closed: "left"
      source: "1d"
    1Y:
      rule: "AS"
      label: "left"
      closed: "left"
      source: "1M"
  # Support per symbol overrides
  symbols:
    # Bonds
    BUND.TR-EUR:
      timeframes:
        4h:                     
          rule: "4H"        # 2025-12-14: OK (week-open 1m frame is not equal to MT4 (data-issue))
          label: "left"
          closed: "left"
          source: "1h"
          origin: "09:00"   # In MT4: first 4H candle of the day starts at this time   
    # Commodities     
    BRENT.CMD-USD:          # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "03:00"   # In MT4: first 4H candle of the day starts at this time
    GAS.CMD-USD:            # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time
    LIGHT.CMD-USD:          # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time
    XAU-USD:                # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time
    # Crypto: Quick look: no override needed
    #         GMT+2 default binning seems OK.
    # Indices
    AUS.IDX-AUD:             # verified: OK (5m->1W)
      # This is an "anomaly" in the pond of fish
      timeframes:
        15m:                     
          rule: "15T"        # 15 minute timeframe
          label: "left"
          closed: "left"
          source: "5m"
          origin: "08:10"   # Starting point of time-bins
        30m:                     
          rule: "30T"        # 30 minute timeframe
          label: "left"
          closed: "left"
          source: "15m"
          origin: "08:10"   # Starting point of time-bins
        1h:                     
          rule: "1H"        # 1 hour timeframe
          label: "left"
          closed: "left"
          source: "30m"
          origin: "08:10"   # Starting point of time-bins
        4h:                     
          rule: "4H"        # 4 hour timeframe
          label: "left"
          closed: "left"
          source: "1h"
          origin: "08:10"   # Starting point of time-bins  
    DEU.IDX-EUR:            # 2025-12-14: OK
      timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time
    DOLLAR.IDX-USD:         # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "03:00"   # In MT4: first 4H candle of the day starts at this time
    GBR.IDX-GBP:
      timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "09:00"   # Starting point of time-bins
    JPN.IDX-JPY:            # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time     
    USA30.IDX-USD:          # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time
    USA500.IDX-USD:         # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time
    USATECH.IDX-USD:        # 2025-12-14: OK
       timeframes:
        4h:                     
          rule: "4H"
          label: "left"
          closed: "left"
          source: "1h"
          origin: "01:00"   # In MT4: first 4H candle of the day starts at this time



    


